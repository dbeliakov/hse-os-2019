<!DOCTYPE html><html lang="en"><head><title>Архитектура компьютера и операционные системы</title><meta charset="utf-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="../../../common/shower/themes/ribbon/styles/screen-16x10.css"><style type="text/css">.caption {
    color: #FFF;
}</style></head><body class="shower list"><header class="caption"><h1>Архитектура компьютера и операционные системы</h1><p>Семинар 22. Потоки</p></header><section id="cover" class="slide"><h2>Семинар 22. Потоки</h2><p>Архитектура компьютера и операционные системы @ ВШЭ, 2018-2019</p><img src="../../../common/cover.jpg" alt="" class="cover"><style type="text/css">#cover h2 {
    margin: 30px 0 0;
    color: #FFF;
    text-align: center;
    font-size: 70px;
    text-shadow: black 1px 1px 0, black -1px -1px 0, 
                 black -1px 1px 0, black 1px -1px 0;
}
#cover p {
    margin: 10px 0 0;
    text-align: center;
    color: #FFF;
    font-style: italic;
    font-size: 20px;
    text-shadow: black 1px 1px 0, black -1px -1px 0, 
                 black -1px 1px 0, black 1px -1px 0;
}
#cover p a {
    color: #FFF;
    text-shadow: black 1px 1px 0, black -1px -1px 0, 
                 black -1px 1px 0, black 1px -1px 0;
}
</style></section><section class="slide"><h2>Развитие процессоров</h2><ul><li><b>1971</b> - Intel 4004, 740 кГц</li><li><b>1989</b> - Intel i486, > 100 МГц</li><li><b>2000</b> - Intel Pentium 3, > 1 ГГц</li><li><b>2017</b> - максимальная частота - до 5 ГГц</li></ul></section><sections class="slide"><h2>Развитие процессоров</h2><ul><li>Рост максимальной частоты процессоров сильно замедлился</li><li>Причина этого кроется в <a href="https://www.iguides.ru/main/other/pochemu_chastoty_protsessorov_ne_rastut_vyshe_neskolkikh_gigagerts/">физических ограничениях</a></li><li>Вертикальное масштабирование программ (т.е. более быстрое исполнение за счет большей частоты процессора) невозможно</li><li>Вместо этого программы масштабируются горизонтально</li></ul></sections><section class="slide"><h2>Многоядерные системы</h2><ul><li>Для увеличения быстродействия программ конструируют многоядерные системы - несколько вычислительных ядер на одном кристалле</li><li>Соременные ОС - многозадачные, процессы распределяются между ядрами</li><li>Но иногда нужно получить от системы максимум в высокопроизводительных вычислениях</li></ul></section><section class="slide"><h2>Конкурентность vs Параллелизм</h2><ul><li>Конкурентность - выполнение нескольких задач за некоторый промежуток времени</li><li>Параллелизм - выполнение нескольких задач одновременно (например, на различных ядрах)</li></ul></section><section class="slide"><h2>Многопроцессное выполнение</h2><ul><li>Программа может запустить несколько процессов, которые будут по максимуму утилизировать ядра</li><li>Минусы - сложность организации взаимодействия между процессами и накладные расходы на переключение процессов</li></ul></section><section class="slide"><h2>Многопоточное выполнение</h2><ul><li>Каждый процесс может выполняться в несколько потоков</li><li>Потоки распределяются между ядрами, максимально их утилизируя</li><li>Потоки выполняются в одном адрессном пространстве, но каждый имеет свой стек</li><li>Переключение потока дешевле, чем переключение процесса</li></ul></section><section class="slide"><h2>Многопоточное выполнение</h2><img src="img/threads.png" style="width: 70%;"></section><sections class="slide"><h2>Многопоточное выполнение</h2><ul><li>Писать и поддерживать многопоточные программы сложнее, чем однопоточные</li><li>Самая частая проблема - <b>race condition</b></li><li>Синхранизация потоков будет рассмотрена в дальнейшем</li></ul></sections><section class="slide"><h2>POSIX threads</h2><ul><li>Будет рассматриваться POSIX API для работы с потоками</li><li>Заголовочный файл - <code>pthread.h</code></li><li>При компиляции программы необходимо использовать флаг <code>-pthread</code></li><li><code>pthread_t</code> — идентификатор потока</li><li><code>pthread_attr_t</code> — перечень атрибутов потока</li></ul></section><section class="slide"><h2>POSIX threads</h2><ul><li>Основная функция потока должна иметь вид <code>void* thread_func(void* ptr);</code></li><li>Агрумент <code>ptr</code> служит для передачи параметров</li><li>Возвращаемое значение можно получить в момент ожидания завершения потока</li><li>Поток может быть завершен с помощью <code>void pthread_exit(void *ptr);</code></li><li>При вызове <code>exit</code> будет завершен весь процесс</li></ul></section><section class="slide"><h2>Создание потока</h2><pre><code style="font-size: 15pt;">int pthread_create(pthread_t *thread,
        const pthread_attr_t *attr,
        void *(*start_routine) (void *),
        void *arg);</code></pre><ul><li>Возвращаемое значение <code>0</code> - успех, <code>EAGAIN</code>, <code>EINVAL</code> и <code>EPERM</code> - ошибка</li><li>Поток начнет исполнение, как только планировщик ОС передаст ей управление</li></ul></section><section class="slide"><h2>Создание потока</h2><ul><li><code>thread</code> - идентификатор потока, ему можно присваивать значение 0, либо его можно сравнивать на равенство или неравенство с другим идентификатором</li><li><code>attr</code> - атрибуты потока, <code>NULL</code> - по умолчанию</li><li><a href="https://www.opennet.ru/docs/RUS/linux_parallel/node54.html">Атрибуты</a> позволяют изменять параметры для планировщика и изменять размер стека (но не меньше, чем <code>sysconf(_SC_THREAD_STACK_MIN)</code>)</li></ul></section><section class="slide"><h2>Ожидание потока</h2><ul><li><code style="font-size: 15pt;">int pthread_join(pthread_t thread, void **retval);</code></li><li><code>retval</code> может быть равно <code>NULL</code></li><li>Поток можно ожидать только один раз</li><li>Отсутствует возможность ждать любой из потоков</li></ul></section><section class="slide"><h2>Thread local storage</h2><ul><li><code>_Thread_local</code> для <code>C</code>, <code>thread_local</code> для <code>C++</code></li><li>Глобальная переменная, доступная во всех функциях, находящихся в единице компиляции ниже точки определения</li><li>Изменения этой переменной не видны в других потоках. Более того, начальное значение не зависит от того, какое оно было в создающем потоке</li></ul></section><div class="progress"></div><script src="../../../common/shower/shower.min.js"></script></body></html>